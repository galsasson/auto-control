
<html>
<head>
	<script src='libs/jquery-3.1.1.min.js'></script>
	<script src='libs/spectrum.js'></script>
	<script src='libs/socket.io.min.js'></script>
	<link rel='stylesheet' href='libs/spectrum.css' />
	<link rel='stylesheet' href='style.css' />
</head>
	<!--
	<table>
		<tr>
			<th>Number</th>
			<th><input id="slider" type ="range" min ="100" max="500" step ="50" value ="100"/></th>
			<th><input id="number" type="number" value="0"/></th>
		</tr>

		<tr>
			<th>Boolean</th>
			<th><input id="check" type="checkbox" />
			</th>
		</tr>

		<tr>
			<th>Color</th>
			<th><input type='text' class="alphaColorPicker" id="colorPicker1" /></th>
		</tr>

		<tr>
			<th>Color (2nd option)</th>
			<th><input type="color"  value="#000000" /></th>
		</tr>
	</table>
-->
<body>
	<table>
		<tr>
			<th>application address:</th>
			<th><input id='address' type='text' value='http://localhost:3000' /></th>
			<th><button onclick='onConnectClick();'>connect</button></th>
		</tr>
	</table>
	<div id="app_params"></div>
</body>


	<script>
		var parametersTable;

		function setColorFields() {
			$(".alphaColorPicker").spectrum({
    			showAlpha: true,
    			showButtons: false
			});
		}


		function createInputRow(item) {
			if (item.type == 'bool') {
				return "<tr class='params_table_tr'><th>"+item.name+"</th><th><input id='"+item.name+"' type='checkbox' /><th></th></tr>"
			}
			else if (item.type == 'float') {
				return "<tr class='params_table_tr'><th>"+item.name+"</th><th><input id='"+item.name+"/slider' type='range' min="+item.min+" max="+item.max+" step="+item.step+" value="+item.value+" /></th><th><input id='"+item.name+"/number' type='number' step="+item.step+" value="+item.value+" /></th></tr>";
			}
			else if (item.type == 'color') {
				return "<tr class='params_table_tr'><th>"+item.name+"</th><th><input type='text' class='alphaColorPicker' id='"+item.name+"' value="+item.value+" /></th><th></th></tr>";
			}
		}

		function createParametersTable(parameters) {
			var table = "<table id='params_table'>";
			parameters.map(function (item) {
				table += createInputRow(item);
			});
			table += "</table>"
			return table;
		}

		function onConnectClick() {
			// Create websockets connection and define the protocol
			var address = $('#address').val();
			console.log("connecting to: "+address);
			var socket = io(address);
			socket.on('connect', function() {
				console.log("connection established");
				socket.emit('get_param_list','');
			});

			socket.on('param_list', function(data){
				console.log("received parameters list:");
				console.log(data);
				$('#app_params').replaceWith(createParametersTable(data));
				setColorFields();
			});

			socket.on('disconnect', function(){
				console.log("disconnected");
			});
		}
	</script>
</html>
